<!DOCTYPE html>
<html lang="de">
<head>
    <!-- Unveränderte CSS und Head-Sektion -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LyricMaster Pro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.18.0/dist/tf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/wavesurfer.js/6.6.3/wavesurfer.min.js"></script>
    <style>
        /* Unverändertes CSS */
        /* ... (CSS bleibt identisch wie im Originalcode) ... */
    </style>
</head>
<body>
    <!-- Unveränderte HTML-Struktur -->
    <!-- ... (HTML bleibt identisch wie im Originalcode) ... -->

    <script>
        let wavesurfer = null;
        let model = null;
        let audioBuffer = null;

        document.addEventListener('DOMContentLoaded', async () => {
            wavesurfer = WaveSurfer.create({
                container: '#waveform',
                waveColor: '#6c5ce7',
                progressColor: '#4b4bff',
                height: 150,
                responsive: true,
                normalize: true,
                cursorColor: '#ffffff'
            });

            wavesurfer.on('play', () => {
                document.querySelector('#playButton i').classList.replace('fa-play', 'fa-pause');
            });

            wavesurfer.on('pause', () => {
                document.querySelector('#playButton i').classList.replace('fa-pause', 'fa-play');
            });

            try {
                model = await tf.loadGraphModel('https://storage.googleapis.com/tfjs-models/sound-classification/vocal-detection/model.json');
            } catch (error) {
                console.error('Fehler beim Laden des Models:', error);
                alert('Modell konnte nicht geladen werden');
            }
        });

        // Start der Korrektur
        async function startProcessing() {
            try {
                const lyrics = document.getElementById('lyricsInput').value.split('\n').filter(l => l.trim());
                if (!audioBuffer) throw new Error('Bitte Audio-Datei hochladen');
                if (lyrics.length === 0) throw new Error('Bitte Lyrics eingeben');
                if (!model) throw new Error('KI-Modell wird noch geladen... Bitte warten'); // Fehlerbehandlung hinzugefügt

                updateUI('Analysiere Audio...', 20);
                
                const vocalSegments = await analyzeAudio(audioBuffer);
                
                updateUI('Erstelle Zeitstempel...', 60);
                
                const lrcContent = generateLRC(lyrics, vocalSegments);
                
                updateUI('Finalisiere...', 90);
                
                createDownload(lrcContent);
                
                updateUI('Fertig!', 100);
                document.getElementById('downloadSection').style.display = 'block';

            } catch (error) {
                alert(`Fehler: ${error.message}`);
                resetUI();
            }
        }
        // Ende der Korrektur

        /* Restlicher JavaScript-Code bleibt unverändert */
        // ... (Rest des Codes bleibt identisch wie im Original) ...
    </script>
</body>
</html>
